<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NRSAC Geology Exam Prep Tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chosen Palette: Slate Gray, Sky Blue, and White -->
    <!-- Application Structure Plan: The application is structured as a syllabus-driven interactive tool. A fixed sidebar navigation lists all major topics from the NRSAC Geology Part-A syllabus. Clicking a topic dynamically filters and displays relevant questions from the provided GATE and GSI source documents in the main content area. This structure was chosen because it directly maps the provided practice materials to the user's study objective, allowing for focused, topic-by-topic preparation which is far more effective than reviewing unsorted question banks. The user flow is simple: select a topic, practice questions, reveal answers, repeat. -->
    <!-- Visualization & Content Choices: The primary goal is to organize and present practice questions for self-assessment. Report Info: Questions from GATE/GSI PDFs. Goal: Organize & Test Knowledge. Presentation Method: Interactive question 'cards' generated with JavaScript. Interaction: User clicks a syllabus topic in the nav to filter questions, then clicks a button on a card to reveal the answer. Justification: This interactive card format is more engaging and user-friendly than a static list. It allows users to test themselves on each question before seeing the answer, which is a key study method. Library/Method: Vanilla JS for DOM manipulation and event handling, Tailwind CSS for styling. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        .main-content {
            transition: opacity 0.3s ease-in-out;
        }
        .question-card {
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .question-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .nav-link.active {
            background-color: #0284c7;
            color: white;
            font-weight: 600;
        }
        .answer {
            transition: max-height 0.5s ease-in-out, opacity 0.5s ease-in-out;
            overflow: hidden;
            max-height: 0;
            opacity: 0;
        }
        .answer.visible {
            max-height: 150px;
            opacity: 1;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .loader-sm {
            width: 1.25rem;
            height: 1.25rem;
            border-radius: 50%;
            display: inline-block;
            border-top: 2px solid #fff;
            border-right: 2px solid transparent;
            animation: spin 0.6s linear infinite;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div id="app" class="flex flex-col md:flex-row min-h-screen">
        
        <header class="md:hidden bg-white shadow-md p-4 flex justify-between items-center sticky top-0 z-20">
            <h1 class="text-xl font-bold text-slate-700">NRSAC Geology Prep</h1>
            <button id="mobile-menu-button" class="text-slate-600 focus:outline-none">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
            </button>
        </header>

        <nav id="sidebar" class="bg-white text-slate-600 w-full md:w-64 lg:w-72 flex-shrink-0 absolute md:relative inset-y-0 left-0 transform -translate-x-full md:translate-x-0 transition-transform duration-300 ease-in-out z-30 md:shadow-lg">
            <div class="p-5 border-b border-slate-200">
                <h2 class="text-2xl font-bold text-slate-800">Syllabus Topics</h2>
                <p class="text-sm text-slate-500 mt-1">Select a topic to practice.</p>
            </div>
            <ul id="topic-list" class="flex flex-col p-4 space-y-2 overflow-y-auto" style="height: calc(100vh - 100px);">
            </ul>
        </nav>

        <main id="main-content" class="flex-1 p-4 sm:p-6 md:p-8 lg:p-10 bg-slate-100">
            <div id="welcome-message" class="text-center h-full flex flex-col justify-center items-center">
                <div class="bg-white p-10 rounded-xl shadow-md max-w-2xl mx-auto">
                    <h1 class="text-3xl md:text-4xl font-bold text-sky-700 mb-4">Welcome to the AI-Powered NRSAC Exam Prep Tool</h1>
                    <p class="text-slate-600 mb-6 text-base md:text-lg">This tool now features **unlimited, AI-generated questions**. Select a topic, and the Gemini AI will create unique practice questions for you on demand.</p>
                    <p class="text-slate-500">To get started, please select a subject from the navigation menu on the left.</p>
                </div>
            </div>
            <div id="question-container" class="hidden">
                 <div id="topic-header" class="mb-6 bg-white p-5 rounded-lg shadow flex flex-col sm:flex-row justify-between sm:items-center gap-4">
                    <div>
                        <h2 id="current-topic-title" class="text-3xl font-bold text-slate-800"></h2>
                        <p id="current-topic-description" class="text-slate-500 mt-1"></p>
                    </div>
                    <button id="explain-concept-btn" class="flex-shrink-0 bg-indigo-500 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-indigo-600 transition-colors duration-200">
                        ✨ Explain Concept
                    </button>
                </div>
                <div id="questions-list" class="grid grid-cols-1 gap-6">
                </div>
                 <div class="mt-8 text-center">
                    <button id="generate-question-btn" class="bg-green-600 text-white font-bold py-3 px-6 rounded-lg shadow-lg hover:bg-green-700 transition-all duration-200 transform hover:scale-105 flex items-center justify-center mx-auto min-w-[200px]">
                        <span id="generate-btn-text">Generate Next Question</span>
                        <div id="generate-btn-loader" class="loader-sm hidden"></div>
                    </button>
                </div>
            </div>
        </main>
    </div>

    <div id="gemini-modal" class="fixed inset-0 bg-black bg-opacity-60 hidden items-center justify-center z-50 p-4 transition-opacity duration-300">
        <div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] flex flex-col transform transition-all duration-300 scale-95 opacity-0">
            <div class="p-5 border-b flex justify-between items-center">
                <h3 id="gemini-modal-title" class="text-xl font-bold text-slate-800">✨ AI Explanation</h3>
                <button id="gemini-modal-close" class="text-slate-500 hover:text-slate-800 text-3xl font-bold">&times;</button>
            </div>
            <div class="p-6 overflow-y-auto">
                <div id="gemini-loader" class="flex justify-center items-center h-48">
                    <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-sky-600"></div>
                </div>
                <div id="gemini-response" class="text-slate-700 leading-relaxed whitespace-pre-wrap" style="font-family: 'Inter', sans-serif;"></div>
            </div>
        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {

    const topicsData = {
        planetarySystems: { title: "Planetary Systems", description: "Origin of Earth and planetary bodies, Earth's orbital parameters, and geological time scale." },
        structuralGeology: { title: "Structural Geology", description: "Concepts of stress and strain, rock deformation, fold and fault mechanics, and tectonic features." },
        economicGeology: { title: "Economic Geology", description: "Mineral resources, ore genesis, prospecting, and economic evaluation of deposits." },
        hydrogeology: { title: "Hydrogeology", description: "Groundwater systems, aquifers, Darcy's law, and groundwater exploration and management." },
        remoteSensingGIS: { title: "Remote Sensing & GIS", description: "Principles of remote sensing, satellite systems, digital image processing, and GIS applications in geology." },
    };

    const topicList = document.getElementById('topic-list');
    const questionContainer = document.getElementById('question-container');
    const questionsList = document.getElementById('questions-list');
    const welcomeMessage = document.getElementById('welcome-message');
    const currentTopicTitle = document.getElementById('current-topic-title');
    const currentTopicDescription = document.getElementById('current-topic-description');
    const explainConceptBtn = document.getElementById('explain-concept-btn');
    const generateQuestionBtn = document.getElementById('generate-question-btn');
    const generateBtnText = document.getElementById('generate-btn-text');
    const generateBtnLoader = document.getElementById('generate-btn-loader');
    const sidebar = document.getElementById('sidebar');
    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const mainContent = document.getElementById('main-content');
    const modal = document.getElementById('gemini-modal');
    const modalContainer = modal.querySelector('div');
    const modalTitle = document.getElementById('gemini-modal-title');
    const modalClose = document.getElementById('gemini-modal-close');
    const modalLoader = document.getElementById('gemini-loader');
    const modalResponse = document.getElementById('gemini-response');
    
    let currentTopicKey = null;
    let currentQuestions = [];

    Object.keys(topicsData).forEach(key => {
        const topic = topicsData[key];
        const listItem = document.createElement('li');
        listItem.innerHTML = `<a href="#" data-topic="${key}" class="nav-link block w-full text-left px-4 py-3 rounded-md text-slate-700 hover:bg-sky-100 hover:text-sky-800 transition-colors duration-200">${topic.title}</a>`;
        topicList.appendChild(listItem);
    });
    
    function showModal() {
        modalResponse.innerHTML = '';
        modalLoader.style.display = 'flex';
        modal.classList.remove('hidden');
        modal.classList.add('flex');
        setTimeout(() => {
            modal.style.opacity = '1';
            modalContainer.style.opacity = '1';
            modalContainer.style.transform = 'scale(1)';
        }, 10);
    }
    
    function hideModal() {
        modal.style.opacity = '0';
        modalContainer.style.opacity = '0';
        modalContainer.style.transform = 'scale(0.95)';
        setTimeout(() => {
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }, 300);
    }

    modalClose.addEventListener('click', hideModal);
    modal.addEventListener('click', (e) => {
        if(e.target === modal) hideModal();
    });

    async function callGemini(userQuery, systemPrompt, jsonMode = false, retries = 3, delay = 1000) {
        const apiKey = "";
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
        
        const payload = {
            contents: [{ parts: [{ text: userQuery }] }],
            systemInstruction: { parts: [{ text: systemPrompt }] },
        };

        if (jsonMode) {
            payload.generationConfig = { responseMimeType: "application/json" };
        }

        try {
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                if ((response.status === 429 || response.status >= 500) && retries > 0) {
                    await new Promise(res => setTimeout(res, delay));
                    return callGemini(userQuery, systemPrompt, jsonMode, retries - 1, delay * 2);
                }
                throw new Error(`API Error: ${response.status} ${response.statusText}`);
            }

            const result = await response.json();
            const candidate = result.candidates?.[0];

            if (candidate?.content?.parts?.[0]?.text) {
                return candidate.content.parts[0].text;
            } else {
                 if (candidate?.finishReason === 'SAFETY') {
                    return "The response could not be generated due to safety settings. Please try a different query.";
                }
                throw new Error("Invalid response structure from Gemini API.");
            }
        } catch (error) {
            console.error("Error calling Gemini API:", error);
            if (retries > 0) {
                await new Promise(res => setTimeout(res, delay));
                return callGemini(userQuery, systemPrompt, jsonMode, retries - 1, delay * 2);
            }
            return jsonMode ? null : "Sorry, an error occurred. Please try again later.";
        }
    }

    function renderTopic(topicKey) {
        currentTopicKey = topicKey;
        currentQuestions = [];
        const topicData = topicsData[topicKey];
        if (!topicData) return;

        welcomeMessage.classList.add('hidden');
        questionContainer.classList.remove('hidden');
        questionsList.innerHTML = ''; 

        currentTopicTitle.textContent = topicData.title;
        currentTopicDescription.textContent = topicData.description;
        
        document.querySelectorAll('.nav-link').forEach(link => {
            link.classList.remove('active');
            if(link.dataset.topic === topicKey) link.classList.add('active');
        });
    }

    function appendQuestionCard(q, index) {
        const card = document.createElement('div');
        card.className = 'question-card bg-white rounded-lg shadow-md p-6 border border-slate-200';
        card.dataset.questionIndex = index;
        
        const optionsHtml = q.o.map((option, i) => `
            <li class="mt-2 text-slate-600">${String.fromCharCode(65 + i)}. ${option}</li>
        `).join('');

        card.innerHTML = `
            <div class="flex justify-between items-start">
                <p class="text-lg font-semibold text-slate-800 pr-4">${index + 1}. ${q.q}</p>
                <span class="flex-shrink-0 text-xs font-semibold bg-blue-100 text-blue-800 px-2 py-1 rounded-full">AI Generated</span>
            </div>
            <ul class="list-none mt-4 pl-4">${optionsHtml}</ul>
            <div class="mt-5 flex items-center space-x-4">
                <button class="toggle-answer-btn text-sm font-medium text-sky-600 hover:text-sky-800 transition">Show Answer</button>
                <button class="explain-answer-btn text-sm font-medium text-purple-600 hover:text-purple-800 transition">✨ Explain Answer</button>
            </div>
            <div class="answer mt-3 p-3 bg-green-50 border-l-4 border-green-500 rounded-r-md">
                <p class="font-semibold text-green-800">Correct Answer: <span class="font-normal">${q.a}</span></p>
            </div>
        `;
        questionsList.appendChild(card);
        card.scrollIntoView({ behavior: 'smooth', block: 'end' });
    }

    topicList.addEventListener('click', (e) => {
        e.preventDefault();
        const link = e.target.closest('.nav-link');
        if (link) {
            const topicKey = link.dataset.topic;
            mainContent.style.opacity = '0';
            setTimeout(() => {
                renderTopic(topicKey);
                mainContent.style.opacity = '1';
                if(window.innerWidth < 768) sidebar.classList.add('-translate-x-full');
            }, 300);
        }
    });

    questionsList.addEventListener('click', async (e) => {
        const target = e.target;
        if (target.classList.contains('toggle-answer-btn')) {
            const answerDiv = target.parentElement.nextElementSibling;
            answerDiv.classList.toggle('visible');
            target.textContent = answerDiv.classList.contains('visible') ? 'Hide Answer' : 'Show Answer';
        } else if (target.classList.contains('explain-answer-btn')) {
            const card = target.closest('.question-card');
            const questionIndex = parseInt(card.dataset.questionIndex, 10);
            const questionData = currentQuestions[questionIndex];
            
            modalTitle.textContent = "✨ Explaining Question";
            showModal();

            const systemPrompt = "You are a geology exam expert. A student is practicing a multiple-choice question. Explain why the correct answer is correct and why the other options are incorrect. Be clear, concise, and educational. Format your response cleanly using paragraphs.";
            const userQuery = `Question: "${questionData.q}"\n\nOptions:\n${questionData.o.map((opt, i) => `${String.fromCharCode(65 + i)}. ${opt}`).join('\n')}\n\nCorrect Answer: "${questionData.a}"\n\nPlease provide a detailed explanation.`;
            
            const explanation = await callGemini(userQuery, systemPrompt);
            modalLoader.style.display = 'none';
            modalResponse.textContent = explanation;
        }
    });

    explainConceptBtn.addEventListener('click', async () => {
        if (!currentTopicKey) return;
        const topicData = topicsData[currentTopicKey];
        
        modalTitle.textContent = `✨ Explaining: ${topicData.title}`;
        showModal();
        
        const systemPrompt = "You are an expert geology professor. Explain the following geological concept clearly and comprehensively, as if you were tutoring a university student preparing for a competitive exam like GATE or GSI. Structure your explanation with clear paragraphs. The concept is: " + topicData.title;
        const userQuery = `Please provide a detailed explanation of "${topicData.title}", which covers: ${topicData.description}`;
        
        const explanation = await callGemini(userQuery, systemPrompt);
        modalLoader.style.display = 'none';
        modalResponse.textContent = explanation;
    });

    generateQuestionBtn.addEventListener('click', async () => {
        if (!currentTopicKey) return;
        
        generateBtnText.classList.add('hidden');
        generateBtnLoader.classList.remove('hidden');
        generateQuestionBtn.disabled = true;

        const topicData = topicsData[currentTopicKey];
        const systemPrompt = `You are an expert question generator for geology competitive exams like GATE and GSI. Create a new, unique, high-quality multiple-choice question based on the provided topic. The question should be challenging and relevant. You MUST provide exactly 4 plausible options, with one clear correct answer. You MUST respond with a single, valid JSON object with the following structure: {"q": "Your question here", "o": ["Option A", "Option B", "Option C", "Option D"], "a": "The correct option text"}. Do not include any other text, markdown, or explanations in your response.`;
        const userQuery = `Topic: ${topicData.title} (${topicData.description}). Generate a question.`;

        const jsonString = await callGemini(userQuery, systemPrompt, true);
        
        try {
            const newQuestion = JSON.parse(jsonString);
            if (newQuestion && newQuestion.q && newQuestion.o && newQuestion.a && newQuestion.o.length === 4) {
                 currentQuestions.push(newQuestion);
                 appendQuestionCard(newQuestion, currentQuestions.length - 1);
            } else {
                throw new Error("Invalid question format received from API.");
            }
        } catch (error) {
            console.error("Failed to parse or display generated question:", error);
            alert("Sorry, there was an error generating the next question. Please try again.");
        } finally {
            generateBtnText.classList.remove('hidden');
            generateBtnLoader.classList.add('hidden');
            generateQuestionBtn.disabled = false;
        }
    });
    
    mobileMenuButton.addEventListener('click', () => {
        sidebar.classList.toggle('-translate-x-full');
    });

});
</script>

</body>
</html>

